<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Asteroids</title>
</head>

<body>
    <canvas id="canvas" width="900" height="700"
        style="border:solid 1px orange; padding:0%; margin:auto;display:block;width:800px;height:600px;position:absolute;top:0%;bottom:0%;left:0%;right:0%">
        Your browser does not support HTML5 Canvas.
    </canvas>

    <script>
        //Canvas
        const canvas = document.querySelector('#canvas');
        const ctx = canvas.getContext("2d");

        const w = canvas.width;
        const h = canvas.height;
        const pi = Math.PI;
        const ship_size = 30;
        const FPS = 30;
        let rightKey = false;
        let leftKey = false;
        let spacebar = false;
        let teclaG = false;

        //ship definitions
        var ship = {
            x: w / 2,
            y: h / 2,
            r: ship_size / 2,
            a: 0 // convert to radians
        }

        class Bullet {
            constructor(x, y, c, d) {
                this.x = x;
                this.y = y;
                this.vX = 2 * Math.cos(d);
                this.vY = 2 * Math.sin(d);
                //d = direção -> bico da nave 
                this.d = d;
                this.c = c;
                this.dispawn = false;
            }

            draw() {
                ctx.beginPath();
                ctx.fillStyle = this.c;
                ctx.arc(this.x, this.y, 3, 0, 2 * pi);
                ctx.fill();
            }

            update() {
                if (this.y + 10 > h) {
                    //destroy
                    this.dispawn = true;
                }
                this.x += this.vX; //update horizontal position 
                this.y += this.vY; //update vertical position 
            }

        }

        class Asteroid {
            constructor(x, y, c, d) {
                this.x = x;
                this.y = y;
                this.vX = 2 * Math.cos(d);
                this.vY = 2 * Math.sin(d);
                this.c = c;
                this.dispawn = false;
            }

            draw() {
                ctx.fillStyle = this.c;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 10, 0, 2 * Math.PI);
                ctx.fill();
            }
            update() {
                //check Canvas vertical collisions
                if (this.x - 10 < 0 || this.x + 10 > w)
                    this.dispawn = true
                //check Canvas horizontal collisions
                if (this.y - 10 < 0 || this.y + 10 > h)
                    this.dispawn = true

                this.x += this.vX; //update horizontal position 
                this.y += this.vY; //update vertical position 
            }
        }

        let bullets = new Array();
        let asteroids = new Array();

        //ANIMATION CYCLE passar ship para class desenhar a nave na class com draw() e update()
        function render() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, w, h);

            // draw ship
            ctx.strokeStyle = "white";
            ctx.lineWidth = ship_size / 20;
            ctx.beginPath()

            ctx.moveTo(
                ship.x + ship.r * Math.cos(0 + ship.a),
                ship.y - ship.r * Math.sin(0 + ship.a)
            );

            ctx.lineTo(
                ship.x + ship.r * Math.cos(3 * Math.PI / 4 + ship.a),
                ship.y - ship.r * Math.sin(3 * Math.PI / 4 + ship.a)
            );

            ctx.lineTo(
                ship.x + ship.r * Math.cos(-3 * Math.PI / 4 + ship.a),
                ship.y - ship.r * Math.sin(-3 * Math.PI / 4 + ship.a)
            );

            ctx.closePath()
            ctx.stroke();


            //UPDATES
            if (rightKey) {
                ship.a -= 0.15;
            }
            if (leftKey) {
                ship.a += 0.15;
            }

            //draw & update
            bullets.forEach(function (bullet) {
                bullet.draw();
                bullet.update();
            });
            // spawn asteroids (para já carregar no G)
            if (teclaG) {
                let x = 0;
                let y = 0;
                let color = 'white';
                let direction = Math.random() * 2 * pi

                asteroids.push(new Asteroid(x, y, color, direction))

            }
            //draw & update
            asteroids.forEach(function (asteroid) {
                asteroid.draw();
                asteroid.update();
            });


            //new frame
            window.requestAnimationFrame(render);
        }
        render();

        for (let i = bullets.length - 1; i >= 0; i--) {
            // check if partical has left the canvas
            if (bullets[i].dispawn = true) {
                bullets.splice(i, 1)
            }

        }

        for (let i = asteroids.length - 1; i >= 0; i--) {
            // check if partical has left the canvas
            if (asteroids[i].dispawn = true) {
                asteroids.splice(i, 1)
            }

        }
        //handler para espaço = balas 
        //32 = barra de espaços
        function spaceBarPressed(e) {
            if (e.keyCode == 32) {
                spacebar = true;
                console.log("space entrou bro")
                // acrescentar a bala ao array. ( copiar o codigode cima e tirar)
            }
            if (spacebar) {
                let x = w / 2;
                let y = h / 2;
                let color = 'white';
                let direction = 4 * 2 * Math.PI;


                bullets.push(new Bullet(x, y, color, direction))

            }
        }

        function spaceBarReleased(e) {
            if (e.keyCode == 32) {
                spacebar = false;
                console.log("space saiu bro")
            }
        }
        

        //handler for keydown
        function KeyPressed(e) {
            //SETAS
            if (e.key == 'ArrowRight') {
                rightKey = true;

            }
            if (e.key == 'ArrowLeft') {
                leftKey = true;
            }
            //tecla G
              if (e.keyCode == 71) {
                teclaG = true;
                console.log("entrou o G bro")
            }
            //SPACEBAR
            if (e.keyCode == 32 && !e.repeat) {
                console.log(e.repeat)
                let x = w / 2;
                let y = h / 2;
                let color = 'white';
                let direction = 4 * 2 * Math.PI;


                bullets.push(new Bullet(x, y, color, direction))
                console.log("space entrou bro")
                // acrescentar a bala ao array. ( copiar o codigode cima e tirar)
            }
            

        }
        //handler for keyup
        function ArrowReleased(e) {
            if (e.key == 'ArrowRight')
                rightKey = false;

            if (e.key == 'ArrowLeft') {
                leftKey = false;
            }
        }

        function asteroidSpawn(e) {
            if (e.keyCode == 71) {
                teclaG = true;
                console.log("entrou o G bro")
            }

        }

        function asteroidSpawnStop(e) {
            if (e.keyCode == 71) {
                teclaG = false;
                console.log("saiu o G bro")

            }
        }
        window.addEventListener('keydown', KeyPressed);
        window.addEventListener('keyup', asteroidSpawnStop);
       // window.addEventListener('keydown', ArrowPressed);
        window.addEventListener('keyup', ArrowReleased);
       // window.addEventListener('keydown', spaceBarPressed);
        window.addEventListener('keyup', spaceBarReleased);
    </script>
</body>

</html>